<th:block>
    <div id="map" style="height: 100vh;"></div>

    <script th:inline="javascript">
        var map = L.map('map').setView([42.0022472, 21.4217587], 13);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        var reports = /*[[${reports}]]*/ null;

        console.log(reports);

        if (reports != null) {
            for (let i = 0; i < reports.length; i++) {
                let marker = L.marker([reports[i].latitude, reports[i].longitude]).addTo(map);
                marker.bindPopup('<div><b>'+reports[i].trashType +'</b><br><div style="display: flex;align-items: center">'+reports[i].description+'</b></div><div style="display: flex;align-items: center">' +
                    reports[i].dateOfReport +'</b></div><b><button style="margin-top: 10px;border: none;background-color: red;color: white;height: 20px;width: 100%;cursor: pointer;" onclick="routeHandler('+ reports[i].latitude + ',' + reports[i].longitude + ')">Рута</button></b></div>').openPopup();

            }
        }
    </script>


    <script>
        var x = document.getElementById("demo");
        var lon;
        var lat;
        var counter = 0;
        // function getLocation() {
        //     if (navigator.geolocation) {
        //         navigator.geolocation.getCurrentPosition(showPosition);
        //     }
        // }

        function routeHandler(reportsLat,reporstsLon){
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(routeMaker);
                routeDrawer(reportsLat,reporstsLon)
            }
            // if(counter = 0){
            //     counter++;
            //     routeHandler(reportsLat,reporstsLon);
            // }
        }

        function routeMaker(position){
            lat = position.coords.latitude;
            lon = position.coords.longitude;
        }

        function routeDrawer(reportsLat,reporstsLon){
            L.Routing.control({
                waypoints: [
                    L.latLng(reportsLat, reporstsLon),
                    L.latLng(lat, lon)
                ]
            }).addTo(map);
            let container = document.querySelector(".leaflet-right");
            container.style.display = "none";
        }

        // function showPosition(position) {
        //     //window.location.replace("/home/nearest?lat=" + position.coords.latitude + "&lon=" + position.coords.longitude);
        //     /*
        //     x.innerHTML = "Latitude: " + position.coords.latitude +
        //         "<br>Longitude: " + position.coords.longitude;*/
        // }
    </script>



    <a href="/createReport" class="btn btn-danger btn-circle btn-lg" style="position: fixed; bottom: 20px; right: 20px; z-index: 999">
        <i class="fa fa-plus"></i>
    </a>


</th:block>